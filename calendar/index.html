<!DOCTYPE html>
<html>
<head>
	<title>calendar</title>
	<meta charset="utf-8">
	<style type="text/css">
		*{margin: 0px; padding: 0px; box-sizing: border-box;}
		ul li{
			list-style: none;
		}
		form#selection{
			display: flex;
			flex-direction: row;
			width: 100%;
			background: #222;
			border-bottom: 1px solid #111;
		}
		form#selection section{
			flex : 25%  ;
			text-align: center;
		}
		form#selection section select{
			height: 1.15em;
			line-height: 1.15em;
			font-size: 1.1em;
			outline: none;
		}
		form#selection section span{
			color: #eee;
			height: 1.15em;
			line-height: 1.15em;
			font-size: 1.1em;
			font-weight: 600;
		}
		form#selection button{
			flex: 12.5%;
			text-align: center;
		}
		.display-date, .weekday{
			display: flex;
			flex-flow: row wrap;
			width: 100%;
			min-width: 210px;
			border: 1px solid #444;
			background: #fff;
		}
		.display-date li, .weekday li{
			flex: 14.285714%;
			text-align: center;
			border: 1px solid #888;
			border-style: inset;
		}
		.weekday li{
			background: #ffc125;
		}
		.weekday li.weekend,
		.display-date li:nth-child(7n+1),
		.display-date li:nth-child(7n){
			background: #ee5c42;
		}
		.current-month{
			color: #333;
			font-size: 1.1em;
			font-weight: 700;
		}
		.prev-month{
			opacity: 0.8;
			color: #aaa;
			font-size: 1em;
			font-weight: 600;
		}
		.next-month{
			opacity: 0.8;
			color: #bbb;
			font-size: 1em;
			font-weight: 600;
		}
		.selected-date{
			color: #333;
			font-size: 1.1em;
			font-weight: 700;
			background: green;
		}
		#prev-month-btn{

		}
		#next-month-btn{

		}

	</style>
</head>
<body>
	<div class='calendar'>
		<section class="content">
			<form id="selection">
				<button id="prev-month-btn">prev</button>			
				<section>
					<select id='years'>
					</select> <span>year</span>
				</section>
				<section>
					<select id='month'>
					</select> <span>month</span>
				</section>
				<section>
					<select id='days'>
					</select> <span> day </span>
				</section>
				<button id="next-month-btn">next</button>
			</form>
			<ul class='weekday'>
				<li class="weekend">日</li>
				<li>一</li>
				<li>二</li>
				<li>三</li>
				<li>四</li>
				<li>五</li>
				<li class="weekend">六</li>
			</ul>
			<ul class='display-date' id="display-date"></ul>
		</section>
		<section class="sidebar">
			
		</section>
	</div>
</body>
<script >
;(function() {
	//the basic date 
	var today = {
			year : 2016,
			month : 1,
			day : 1,
			week : 4,
			afterOffset : 4,
			beforeOffset : 12
		};
	var year = today.year,
		month = today.month,
		day = today.day,
		week = today.week,
		aftOffset = today.afterOffset,
		befOffset = today.beforeOffset;
	var smallMonths = [4,6,9,11],
		bigMonths = [1,3,5,7,8,10,12];

	var getWeekday = function(Year, Month, Day){
		var total = getTotalDays(Year, Month, Day),
			weekDay = getWeek( total ),
			mounthMaxDate = maxDate(Year, Month),
			firstDayOfMonth = ((1-Day)%7+weekDay)%7;
		return {date 	     : Year+'-'+ Month+'-'+Day,
				total        : total,
				weekDay      : weekDay,
				mounthMaxDate: mounthMaxDate,
				firstDay     : firstDayOfMonth 
				};
	};
	// year 
	function getTotalDays(Year,Month,Day){
		if(invalidDate.value){
			return invalid.msg;
		};
		var	sumDays = 0,
			leapYears = 0,
			offsetYears = 0,
			offsetMonths = 0,
			offsetDays = 0;

			if(Year == year){				
				//month
				for(var i = 1; i< Month; i++){
					sumDays += getDaysInMonth(i, Year);
				}
				sumDays += Day;
			}else if(Year > year){
				while(Year > year){
					if( isLeapYear(year++) ){
						sumDays += 366;
					}else{
						sumDays += 365;
					};
				}
				year = today.year;
				//month
				for(var i = 1; i< Month; i++){
					sumDays += getDaysInMonth(i, Year);
				}
				sumDays += Day;
			}else if( Year < year ){
				while( Year < year ){
					if( isLeapYear(year-1) ){
						sumDays -= 366;
					}else{
						sumDays -= 365;
					};
					year --;
				};
				year = today.year;
				//month
				for(var i = 1 ; i < Month; i++){
					sumDays += getDaysInMonth(i, Year);
				}
				sumDays += Day-1;
			}
		return sumDays;
	};
	function isLeapYear(year){
		if( (year%4==0&&year%100!=0)||year%400==0 )	return 1;
		return 0;
	};
	//month
	function maxDate(Year,Month){
		var leapYear       =  isLeapYear(Year),
			February       = Month == 2 ? 1 : 0 ,
			smallMonth     = smallMonths.indexOf(Month) >-1 ? 1 : 0,
			bigMonth       = bigMonths.indexOf(Month) >-1 ? 1 : 0;
		var prevMonth      = Month == 1 ? 12 : Month-1,
			prevFebruary   = prevMonth == 2 ? 1 : 0 
			prevsmallMonth = smallMonths.indexOf(prevMonth) >-1 ? 1 : 0,
			prevbigMonth   = bigMonths.indexOf(prevMonth) >-1 ? 1 : 0;
		var currentMonthMaxDate , prevMonthMaxDate;

		if( smallMonth ){
			currentMonthMaxDate = 30;
		}else if( bigMonth ){
			currentMonthMaxDate = 31;
		}else if( February ){		
			currentMonthMaxDate = leapYear ? 29 : 28;			
		};

		if( prevsmallMonth ){
			prevMonthMaxDate = 30;
		}else if( prevbigMonth ){
			prevMonthMaxDate = 31;
		}else if( prevFebruary ){		
			prevMonthMaxDate = leapYear ? 29 : 28;			
		};
		return {cur : currentMonthMaxDate, prev : prevMonthMaxDate};
	};
	//get week
	function getWeek(totalDays){
		var targetWeek = null;
		if(totalDays >= 0){
			targetWeek = (totalDays%7+aftOffset)%7;	
		}else{
			targetWeek = (totalDays%7+befOffset)%7;
		}
		return targetWeek;
	};	
	function getDaysInMonth (month, Year){
		var days = 0;			
		if( month == 2 ){
			if(isLeapYear(Year) ){
				days = 29;
			}else{
				days = 28;
			}
		}else if( smallMonths.indexOf(month) >= 0){
			days = 30;
		}else if( bigMonths.indexOf(month) >= 0){
			days = 31;
		}
		return days;
	};
	function invalidDate(Month, Day){
		var errorMessage = 'invalid date: ',
			value = 0;
		if( Month > 12 || Month < 1){
			errorMessage += "bad month. ";
			value = 1;
		};
		if( smallMonths.indexOf(Month) > -1 && (Day > 30 || Day <1) ){
			errorMessage += "bad day. ";
			value = 1;
		}else if(bigMonths.indexOf(Month) > -1 && (Day > 31 || Day <1) ){
			errorMessage += "bad day. ";
			value = 1;
		}else if( Month == 2  ){
			if( isLeapYear(Year)){
				if(Day > 29 || Day <1){
				 errorMessage += "bad day. ";
				 value = 1;
				};		
			}else{
				if(Day > 28 || Day <1){
				 errorMessage += "bad day. ";
				 value = 1;
				};				
			};			
		};
		return {value : value,msg : errorMessage};
	};
	window.getWeekday = getWeekday;
})();

;(function(){
	var CreateCalendar = function(selector){
		return new CreateCalendar.fn(selector);
	};
	CreateCalendar.fn = function(selector){
		this.elem = typeof selector == 'object' ? selector : document.getElementById(selector);
		
		//this.init();
	};
	CreateCalendar.fn.prototype = {
		constructor : CreateCalendar.fn,
		className : '',
		startTag : "<li>",
		endTag : "</li>",
		className : 'current-month',
		prevMonthStyle : 'prev-month',
		nextMonthStyle : 'next-month',
		children : null,
		creatDays : function(){
			var firstDayOfWeek = this.firstDay,
				curMaxDate = this.mounthMaxDate.cur,
				prevMaxDate = this.mounthMaxDate.prev,
				j =0,
				maxGrid = null,
			 	lis ='';
			//empty the element
			this.elem.innerHTML = '';
			for(var i = 0; i < firstDayOfWeek; i++){
				j++;	
				lis += this.startTag+ (prevMaxDate-firstDayOfWeek+j)+this.endTag ;			
			};
			for(; i< curMaxDate+ firstDayOfWeek ; i++){
				lis += this.startTag+( i-firstDayOfWeek+1 )+this.endTag ;
			};
			maxGrid = i> 35 ? 42 : 35;
			j = 0;
			for(; i< maxGrid ; i++){
				++j;
				lis += this.startTag+j+this.endTag;
			};
			this.elem.innerHTML = lis;
			this.children = this.elem.childNodes;
			return this;
		},
		setCSSstyle : function(){
			var firstDayOfWeek = this.firstDay,
				curMaxDate = this.mounthMaxDate.cur,
				maxGrid = null,
				children = this.elem.childNodes;
			for(var i = 0; i < firstDayOfWeek; i++){
				children[i].className = this.prevMonthStyle;		
			};
			for(; i< curMaxDate+ firstDayOfWeek ; i++){
				children[i].className = this.className;
			};
			maxGrid = i> 35 ? 42 : 35;
			for(; i< maxGrid ; i++){
				children[i].className = this.nextMonthStyle;
			};
			return this;
		}
	};
	CreateCalendar.fn.extend = CreateCalendar.fn.prototype.extend = function(obj){
		var copy = null,
			self = this;
		for(name in obj){
			copy = obj[name];
			this[name] = copy;
		};
		return this;
	};

	window.CreateCalendar = CreateCalendar;
}());

;(function(){
	var CreatDate = function(yearsEle, monthEle, dayEle){
		return new CreatDate.fn(yearsEle, monthEle, dayEle);
	};
	CreatDate.fn = function(yearEle, monthEle, dayEle){
		this.yearEle  = typeof yearEle == 'object' ? yearEle : document.getElementById(yearEle);
		this.monthEle = typeof monthEle == 'object' ?  monthEle : document.getElementById(monthEle);
		this.dayEle   = typeof dayEle == 'object' ? dayEle : document.getElementById(dayEle);
		this.startTag = "<option>";
		this.endTag   = "</option>";
		this.init();
	};
	CreatDate.fn.prototype = {
		constructor : CreatDate.fn,
		year : null,
		month : null,
		day : null,
		init : function(){
			this.getTodayDate();
			this.createYears();
			this.createMonth();
			this.createDays();
		},
		getTodayDate : function(){
			var date = new Date();
			this.year = date.getYear()+1900;
			this.month = date.getMonth()+1;
			this.day = date.getDate();
		},
		createYears : function(){
			var self = this,				
				options = '';
			self.yearEle.innerHTML = options;
			for (var i = 2050; i>=1900; i--) {
				options+= this.startTag +i+this.endTag;
			}
			self.yearEle.innerHTML = options;
			selectedFn(self.yearEle, self.year);
			self.yearEle.addEventListener('change',function(evt){
				self.year = self.yearEle.value-0;
			});
		},
		createMonth : function(){
			var self = this,
				options = '';
			self.monthEle.innerHTML = options;
			for (var i = 12; i>=1; i--) {
				options+= this.startTag +i+this.endTag;
			}
			self.monthEle.innerHTML = options;
			selectedFn(self.monthEle, self.month);
			self.monthEle.addEventListener('change',function(evt){
				self.month = self.monthEle.value-0;
			});

			self.dayEle.addEventListener('mousedown',function(evt){
				_maxDate = maxDate(self.year,self.month);
				options = '';
				for (var i = _maxDate; i>=1; i--) {
					options+= self.startTag +i+self.endTag;
				};
				self.dayEle.innerHTML = options;
			},false);
		},
		createDays : function(){
			var self = this,
				_maxDate = maxDate(self.year,self.month),
				options = '';
			self.dayEle.innerHTML = options;

			for (var i = _maxDate; i>=1; i--) {
				options+= this.startTag +i+this.endTag;
			};
			self.dayEle.innerHTML = options;
			selectedFn(self.dayEle, self.day);
						
			days.addEventListener('change',function(evt){
				self.day = days.value-0;
			});
		},
		prevMonthFn : function(){
			var self = this;
			if(this.month == 1){
				this.month = 12;
				--this.year;
				selectedFn(self.yearEle, self.year);
			}else{
				--this.month;
			}
			selectedFn(self.monthEle, self.month);
		},
		nextMonthFn : function(){
			var self = this;
			if(this.month == 12){
				this.month = 1;
				++this.year;
				selectedFn(self.yearEle, self.year);
			}else{
				++this.month;
			}
			selectedFn(this.monthEle, this.month);
		}
	};

	function selectedFn(ele,value){
		var children = ele.childNodes;
		for(var i = 0; i < children.length; i++){
			if(children[i].innerText == value+'') {
				children[i].selected = 'selected';
			}else {
				children[i].selected = '';
			}
		}
	};
	function isLeapYear(year){
		if( (year%4==0&&year%100!=0)||year%400==0 )	return 1;
		return 0;
	};
	//month
	function maxDate(Year,Month){
		var smallMonths = [4,6,9,11],
			bigMonths = [1,3,5,7,8,10,12];
		var leapYear       = isLeapYear(Year),
			February       = Month == 2 ? 1 : 0 ,
			smallMonth     = smallMonths.indexOf(Month) >-1 ? 1 : 0,
			bigMonth       = bigMonths.indexOf(Month) >-1 ? 1 : 0;
		
		var currentMonthMaxDate ;
		if( smallMonth ){
			currentMonthMaxDate = 30;
		}else if( bigMonth ){
			currentMonthMaxDate = 31;
		}else if( February ){		
			currentMonthMaxDate = leapYear ? 29 : 28;			
		};
		return currentMonthMaxDate;
	};

	window.CreatDate = CreatDate;
})();

(function(){
	var form = document.getElementById('selection'),
		prevMonth = document.getElementById('prev-month-btn'),
		nextMonth = document.getElementById('next-month-btn');
	var createDate = CreatDate('years', 'month', 'days');

	var _getWeekday = getWeekday(createDate.year, createDate.month, 1);
		createCalendar = CreateCalendar('display-date');
		createCalendar.extend(_getWeekday).creatDays().setCSSstyle();
		pointSelectedDate();

	prevMonth.addEventListener('click',function(){
		createDate.prevMonthFn()
	},false);
	nextMonth.addEventListener('click',function(){
		createDate.nextMonthFn();
	},false);
	form.addEventListener('click',function(evt){
		evt.preventDefault();
		_getWeekday = getWeekday(createDate.year, createDate.month, 1);
		createCalendar.extend(_getWeekday).creatDays().setCSSstyle();		
		pointSelectedDate();
	},false);

	function pointSelectedDate(){
		for(var i =41; i>=0 ; i--){
			if(i ==  createDate.day + _getWeekday.firstDay -1 ){
				createCalendar.children[i].style.background = 'green';
				return;
			}
		};
	};
})();




</script>
</html>